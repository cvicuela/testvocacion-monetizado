<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Career Aptitude Assessment / Test Vocacional</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --navy: #1B1464;
    --dark-blue: #2D2194;
    --med-blue: #4834D4;
    --accent: #6C5CE7;
    --gold: #FDA7DF;
    --gold-light: #FFEEF9;
    --bg: #F5F3FF;
    --card: #FFFFFF;
    --text: #1A1A2E;
    --text-light: #5A6178;
    --border: #E2E5EB;
    --green: #00B894;
    --green-light: #E6FFF7;
    --c1: #6C5CE7; /* Creative */
    --c2: #00B894; /* Scientific */
    --c3: #FDCB6E; /* Social */
    --c4: #E17055; /* Business */
    --c5: #0984E3; /* Technical */
    --shadow: 0 1px 3px rgba(27,20,100,0.06), 0 4px 14px rgba(27,20,100,0.04);
    --shadow-lg: 0 4px 20px rgba(27,20,100,0.08), 0 8px 32px rgba(27,20,100,0.04);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { font-family:'DM Sans',sans-serif; background:var(--bg); color:var(--text); line-height:1.6; -webkit-font-smoothing:antialiased; }

  /* LANGUAGE SELECTOR */
  .lang-screen {
    min-height:100vh; display:flex; align-items:center; justify-content:center;
    background: linear-gradient(135deg, var(--navy) 0%, var(--dark-blue) 50%, var(--med-blue) 100%);
    position:relative; overflow:hidden;
  }
  .lang-screen::before { content:''; position:absolute; top:-30%; right:-15%; width:600px; height:600px; border-radius:50%; background:radial-gradient(circle,rgba(108,92,231,0.15) 0%,transparent 70%); }
  .lang-screen::after { content:''; position:absolute; bottom:-30%; left:-10%; width:500px; height:500px; border-radius:50%; background:radial-gradient(circle,rgba(253,167,223,0.1) 0%,transparent 70%); }
  .lang-box { position:relative; z-index:1; text-align:center; max-width:480px; padding:24px; }
  .lang-box .badge { display:inline-block; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.12); border-radius:100px; padding:6px 20px; font-size:11px; font-weight:600; letter-spacing:2.5px; text-transform:uppercase; color:var(--gold-light); margin-bottom:24px; }
  .lang-box h1 { font-family:'Playfair Display',serif; font-size:clamp(28px,5vw,38px); font-weight:600; color:white; margin-bottom:8px; }
  .lang-box p { color:rgba(255,255,255,0.5); font-size:14px; margin-bottom:40px; }
  .lang-buttons { display:flex; gap:16px; justify-content:center; flex-wrap:wrap; }
  .lang-btn {
    display:flex; flex-direction:column; align-items:center; gap:10px;
    background:rgba(255,255,255,0.06); border:1.5px solid rgba(255,255,255,0.12);
    border-radius:16px; padding:28px 40px; cursor:pointer; transition:all 0.3s; min-width:180px;
  }
  .lang-btn:hover { background:rgba(255,255,255,0.1); border-color:rgba(255,255,255,0.25); transform:translateY(-3px); }
  .lang-flag { font-size:36px; }
  .lang-name { color:white; font-size:16px; font-weight:600; }
  .lang-sub { color:rgba(255,255,255,0.4); font-size:12px; font-weight:400; }
  .lang-screen.hidden { display:none; }

  /* HEADER */
  .header {
    background: linear-gradient(135deg, var(--navy) 0%, var(--dark-blue) 50%, var(--med-blue) 100%);
    padding: 48px 24px 56px; text-align:center; position:relative; overflow:hidden;
  }
  .header::before { content:''; position:absolute; top:-50%; right:-20%; width:500px; height:500px; border-radius:50%; background:radial-gradient(circle,rgba(108,92,231,0.15) 0%,transparent 70%); }
  .header::after { content:''; position:absolute; bottom:-40%; left:-10%; width:400px; height:400px; border-radius:50%; background:radial-gradient(circle,rgba(253,167,223,0.1) 0%,transparent 70%); }
  .badge { display:inline-block; background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.12); border-radius:100px; padding:6px 20px; font-size:11px; font-weight:600; letter-spacing:2.5px; text-transform:uppercase; color:var(--gold-light); margin-bottom:20px; position:relative; z-index:1; }
  .header h1 { font-family:'Playfair Display',serif; font-size:clamp(26px,5vw,40px); font-weight:600; color:white; letter-spacing:-0.5px; margin-bottom:12px; position:relative; z-index:1; }
  .header p { color:rgba(255,255,255,0.6); font-size:15px; font-weight:300; max-width:520px; margin:0 auto; position:relative; z-index:1; }
  .lang-switch { position:absolute; top:16px; right:20px; z-index:5; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.15); border-radius:8px; padding:6px 14px; color:rgba(255,255,255,0.7); font-size:12px; font-weight:600; cursor:pointer; transition:all 0.2s; font-family:'DM Sans',sans-serif; }
  .lang-switch:hover { background:rgba(255,255,255,0.18); color:white; }
  .sound-toggle { position:absolute; top:16px; left:20px; z-index:5; background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.15); border-radius:8px; padding:6px 14px; color:rgba(255,255,255,0.7); font-size:14px; cursor:pointer; transition:all 0.2s; font-family:'DM Sans',sans-serif; display:flex; align-items:center; gap:6px; }
  .sound-toggle:hover { background:rgba(255,255,255,0.18); color:white; }
  .sound-toggle .sl { font-size:11px; font-weight:600; }

  .progress-wrap { max-width:680px; margin:-24px auto 0; padding:0 24px; position:sticky; top:0; z-index:10; }
  .progress-card { background:var(--card); border-radius:16px; padding:16px 24px; box-shadow:var(--shadow-lg); display:flex; align-items:center; gap:16px; }
  .progress-label { font-size:12px; font-weight:600; letter-spacing:1px; text-transform:uppercase; color:var(--text-light); white-space:nowrap; }
  .progress-bar-bg { flex:1; height:6px; background:var(--bg); border-radius:100px; overflow:hidden; }
  .progress-bar-fill { height:100%; background:linear-gradient(90deg,var(--accent),var(--gold)); border-radius:100px; transition:width 0.5s cubic-bezier(0.4,0,0.2,1); width:0%; }
  .progress-pct { font-size:13px; font-weight:700; color:var(--navy); min-width:60px; text-align:right; }

  .main { max-width:680px; margin:0 auto; padding:32px 24px 80px; }

  .intro-card { background:var(--card); border-radius:16px; padding:36px 32px; box-shadow:var(--shadow); margin-bottom:28px; }
  .intro-card h2 { font-family:'Playfair Display',serif; font-size:22px; font-weight:600; color:var(--navy); margin-bottom:12px; }
  .intro-card p { color:var(--text-light); font-size:14px; line-height:1.7; margin-bottom:8px; }
  .highlight { background:linear-gradient(120deg,rgba(108,92,231,0.08) 0%,rgba(253,167,223,0.08) 100%); border-left:3px solid var(--accent); border-radius:0 8px 8px 0; padding:12px 16px; margin-top:16px; font-size:13px; color:var(--text); font-weight:500; }

  .name-section { background:var(--card); border-radius:16px; padding:28px 32px; box-shadow:var(--shadow); margin-bottom:28px; }
  .name-section label { display:block; font-size:12px; font-weight:600; letter-spacing:1.5px; text-transform:uppercase; color:var(--text-light); margin-bottom:10px; }
  .name-input { width:100%; padding:14px 18px; border:1.5px solid var(--border); border-radius:10px; font-family:'DM Sans',sans-serif; font-size:15px; color:var(--text); background:var(--bg); transition:all 0.2s; outline:none; }
  .name-input:focus { border-color:var(--accent); box-shadow:0 0 0 3px rgba(108,92,231,0.1); background:white; }

  /* WIZARD */
  .wizard-step { display:none; }
  .wizard-step.active { display:block; }
  .wizard-step .q-card { opacity:1; transform:none; animation:slideIn 0.35s ease; margin-bottom:0; }
  @keyframes slideIn { from { opacity:0; transform:translateX(30px); } to { opacity:1; transform:translateX(0); } }

  .q-card { background:var(--card); border-radius:16px; box-shadow:var(--shadow); overflow:hidden; }
  .q-header { padding:22px 28px; border-bottom:1px solid var(--border); display:flex; align-items:center; gap:14px; }
  .q-num { width:36px; height:36px; border-radius:10px; background:var(--navy); color:white; display:flex; align-items:center; justify-content:center; font-size:14px; font-weight:700; flex-shrink:0; }
  .q-text { font-size:15px; font-weight:600; color:var(--navy); line-height:1.4; }
  .q-options { padding:12px 16px 16px; display:grid; gap:8px; }
  .q-option { display:flex; align-items:center; gap:12px; padding:14px 18px; border-radius:10px; cursor:pointer; transition:all 0.2s; border:1.5px solid transparent; background:var(--bg); user-select:none; }
  .q-option:hover { background:white; border-color:var(--border); }
  .q-option.selected { border-color:var(--accent); background:rgba(108,92,231,0.04); }
  .q-radio { width:20px; height:20px; border-radius:50%; border:2px solid var(--border); display:flex; align-items:center; justify-content:center; flex-shrink:0; transition:all 0.2s; }
  .q-option.selected .q-radio { border-color:var(--accent); background:var(--accent); }
  .q-radio::after { content:''; width:8px; height:8px; border-radius:50%; background:white; opacity:0; transition:opacity 0.2s; }
  .q-option.selected .q-radio::after { opacity:1; }
  .q-option-text { font-size:14px; color:var(--text); }

  .nav-buttons { display:flex; gap:12px; margin-top:24px; }
  .btn-nav { flex:1; padding:16px 24px; border-radius:12px; font-family:'DM Sans',sans-serif; font-size:15px; font-weight:600; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; justify-content:center; gap:8px; border:none; }
  .btn-prev { background:white; color:var(--navy); border:1.5px solid var(--border); }
  .btn-prev:hover { border-color:var(--accent); color:var(--accent); }
  .btn-next { background:linear-gradient(135deg,var(--navy),var(--dark-blue)); color:white; box-shadow:0 4px 16px rgba(27,20,100,0.2); }
  .btn-next:hover { transform:translateY(-2px); box-shadow:0 6px 24px rgba(27,20,100,0.3); }
  .btn-next:disabled { opacity:0.35; cursor:not-allowed; transform:none; box-shadow:none; }
  .btn-start { background:linear-gradient(135deg,var(--navy),var(--dark-blue)); color:white; box-shadow:0 4px 16px rgba(27,20,100,0.2); width:100%; padding:16px; border-radius:12px; font-family:'DM Sans',sans-serif; font-size:15px; font-weight:600; cursor:pointer; border:none; transition:all 0.2s; margin-top:24px; }
  .btn-start:hover { transform:translateY(-2px); box-shadow:0 6px 24px rgba(27,20,100,0.3); }
  .q-hint { text-align:center; margin-top:16px; font-size:12px; color:var(--text-light); opacity:0.7; }

  /* RESULTS */
  .results-container { display:none; }
  .results-container.visible { display:block; }
  .results-body { max-width:680px; margin:0 auto; padding:32px 24px 80px; }
  .result-card { background:var(--card); border-radius:16px; padding:32px; box-shadow:var(--shadow); margin-bottom:20px; }
  .result-card h2 { font-family:'Playfair Display',serif; font-size:20px; font-weight:600; color:var(--navy); margin-bottom:16px; padding-bottom:12px; border-bottom:1px solid var(--border); }
  .result-card h2 .sn { font-family:'DM Sans',sans-serif; font-size:11px; font-weight:700; color:var(--accent); letter-spacing:1.5px; display:block; margin-bottom:4px; }
  .result-card p { color:var(--text-light); font-size:14px; line-height:1.75; margin-bottom:12px; }
  .result-card p:last-child { margin-bottom:0; }
  .result-card strong { color:var(--text); }
  .primary-badge { display:inline-block; padding:8px 20px; border-radius:100px; font-size:13px; font-weight:700; letter-spacing:1px; text-transform:uppercase; margin-bottom:8px; margin-right:6px; }
  .score-row { display:flex; align-items:center; gap:12px; margin-bottom:14px; }
  .score-label { width:100px; font-size:12px; font-weight:700; letter-spacing:0.5px; text-transform:uppercase; text-align:right; flex-shrink:0; }
  .score-bar-bg { flex:1; height:28px; background:var(--bg); border-radius:8px; overflow:hidden; }
  .score-bar-fill { height:100%; border-radius:8px; transition:width 1s cubic-bezier(0.4,0,0.2,1); width:0%; display:flex; align-items:center; justify-content:flex-end; padding-right:10px; }
  .score-val { font-size:12px; font-weight:800; color:white; }
  .radar-wrap { display:flex; justify-content:center; padding:20px 0; }
  .trait-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px; }
  .trait-item { padding:12px 16px; border-radius:8px; font-size:13px; font-weight:500; }
  .trait-strength { background:var(--green-light); color:#00876A; }
  .trait-blind { background:#FFF3E0; color:#BF6C00; }
  .career-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px; }
  .career-item { padding:14px 18px; border-radius:10px; background:var(--bg); border:1px solid var(--border); }
  .career-item strong { display:block; font-size:14px; color:var(--navy); margin-bottom:2px; }
  .career-item span { font-size:12px; color:var(--text-light); }

  .results-footer { text-align:center; padding:32px 24px; border-top:1px solid var(--border); margin-top:12px; }
  .results-footer p { font-size:12px; color:var(--text-light); }
  .btn-retake { display:inline-block; margin-top:16px; padding:12px 32px; border-radius:10px; border:1.5px solid var(--border); background:white; font-family:'DM Sans',sans-serif; font-size:13px; font-weight:600; color:var(--navy); cursor:pointer; transition:all 0.2s; }
  .btn-retake:hover { border-color:var(--accent); color:var(--accent); }

  .share-section { background:var(--card); border-radius:16px; padding:32px; box-shadow:var(--shadow); margin-bottom:20px; text-align:center; }
  .share-section h3 { font-family:'Playfair Display',serif; font-size:18px; font-weight:600; color:var(--navy); margin-bottom:6px; }
  .share-section p { font-size:13px; color:var(--text-light); margin-bottom:20px; }
  .share-buttons { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
  .share-btn { display:inline-flex; align-items:center; gap:8px; padding:12px 24px; border-radius:10px; font-family:'DM Sans',sans-serif; font-size:13px; font-weight:600; cursor:pointer; border:none; transition:all 0.2s; letter-spacing:0.3px; }
  .share-btn:hover { transform:translateY(-2px); }
  .share-btn.print { background:var(--navy); color:white; }
  .share-btn.whatsapp { background:#25D366; color:white; }
  .share-btn svg { width:18px; height:18px; fill:currentColor; }

  .form-container { display:none; }
  .form-container.visible { display:block; }

  .print-watermark { display:none; }
  @media print {
    .share-section, .results-footer, .lang-switch, .btn-retake, .sound-toggle { display:none !important; }
    body { background:white !important; -webkit-print-color-adjust:exact; print-color-adjust:exact; }
    .header { padding:24px 24px 28px !important; }
    .header h1 { font-size:24px !important; }
    .results-container.visible { display:block !important; }
    .results-body { padding:16px 24px 20px !important; }
    .result-card { break-inside:avoid; page-break-inside:avoid; box-shadow:none !important; border:1px solid #ddd; margin-bottom:12px !important; padding:20px 24px !important; }
    .result-card h2 { font-size:16px !important; }
    .result-card p { font-size:12px !important; line-height:1.6 !important; }
    .career-grid { gap:6px !important; }
    .career-item { padding:10px 14px !important; }
    .trait-grid { gap:6px !important; }
    .trait-item { padding:8px 12px !important; font-size:11px !important; }
    .print-watermark { display:block !important; position:fixed; bottom:12px; left:0; right:0; text-align:center; font-family:'DM Sans',sans-serif; font-size:9px; color:#B0B8C8; letter-spacing:1px; }
  }

  @media (max-width:600px) {
    .trait-grid, .career-grid { grid-template-columns:1fr; }
    .score-label { width:75px; font-size:11px; }
    .result-card { padding:24px 20px; }
    .intro-card,.name-section { padding:24px 20px; }
    .q-header { padding:18px 20px; }
    .q-options { padding:10px 12px 14px; }
    .lang-btn { padding:24px 28px; min-width:150px; }
  }

  /* PAYWALL (preview + blur) */
  .locked { position:relative; overflow:hidden; }
  .locked .locked-content { opacity:0.92; pointer-events:none; user-select:none; }
  .locked .locked-content p,
  .locked .locked-content .trait-grid,
  .locked .locked-content .career-grid { filter: blur(8px); }
  .locked .locked-overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding:18px;
    background: linear-gradient(180deg, rgba(245,243,255,0.35), rgba(245,243,255,0.88)); border:1px solid var(--border); }
  .locked-box { width:100%; max-width:560px; background: rgba(255,255,255,0.94); border:1px solid rgba(226,229,235,0.9);
    border-radius:16px; padding:18px; box-shadow: var(--shadow-lg); text-align:center; }
  .locked-box h4 { font-family:'Playfair Display',serif; font-size:18px; color:var(--navy); margin-bottom:6px; }
  .locked-box p { font-size:13px; color:var(--text-light); margin-bottom:14px; }
  .plan-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px; }
  .plan-card { background:white; border:1.5px solid var(--border); border-radius:14px; padding:14px; text-align:left; }
  .plan-card.reco { border-color: var(--accent); background: linear-gradient(135deg, rgba(108,92,231,0.04), rgba(253,167,223,0.04)); }
  .plan-title { font-weight:800; color:var(--navy); font-size:13px; }
  .plan-price { font-weight:900; color:var(--accent); font-size:22px; margin-top:6px; }
  .plan-note { font-size:12px; color:var(--text-light); margin-top:6px; }
  .paypal-slot { margin-top:10px; }
  .legal-mini { margin-top:12px; font-size:11px; color:var(--text-light); line-height:1.5; text-align:left; }
  .legal-mini a { color:var(--accent); text-decoration:none; font-weight:700; }
  .legal-mini a:hover { text-decoration:underline; }
  .ref-box { margin-top:10px; border-radius:12px; border:1.5px solid var(--border); background:var(--bg); padding:12px; text-align:left; }
  .ref-box label { font-size:11px; font-weight:800; color:var(--text-light); letter-spacing:1px; text-transform:uppercase; }
  .ref-box input { width:100%; margin-top:8px; padding:12px 12px; border-radius:10px; border:1.5px solid var(--border); outline:none; font-family:'DM Sans',sans-serif; }
  .ref-row { display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-top:8px; }
  .ref-status { margin-top:10px; font-size:12px; font-weight:700; }
  @media (max-width:600px){ .plan-grid{grid-template-columns:1fr;} .ref-row{grid-template-columns:1fr;} }

</style>
</head>
<body>

<!-- LANGUAGE SELECT -->
<div class="lang-screen" id="langScreen">
  <div class="lang-box">
    <div class="badge">Career Assessment</div>
    <h1>Select Your Language</h1>
    <p>Choose the language for your vocational assessment</p>
    <div class="lang-buttons">
      <div class="lang-btn" onclick="startAssessment('en')">
        <span class="lang-flag">üá∫üá∏</span>
        <span class="lang-name">English</span>
        <span class="lang-sub">Career Aptitude Test</span>
      </div>
      <div class="lang-btn" onclick="startAssessment('es')">
        <span class="lang-flag">üá™üá∏</span>
        <span class="lang-name">Espa√±ol</span>
        <span class="lang-sub">Test Vocacional</span>
      </div>
    </div>
  </div>
</div>

<!-- FORM -->
<div class="form-container" id="formContainer">
  <div class="header">
    <button class="lang-switch" id="langSwitchBtn" onclick="switchLang()">üåê</button>
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîä <span class="sl" id="soundLabel">ON</span></button>
    <div class="badge" id="hBadge"></div>
    <h1 id="hTitle"></h1>
    <p id="hSub"></p>
  </div>
  <div class="progress-wrap">
    <div class="progress-card">
      <span class="progress-label" id="progLabel"></span>
      <div class="progress-bar-bg"><div class="progress-bar-fill" id="progressFill"></div></div>
      <span class="progress-pct" id="progressPct"></span>
    </div>
  </div>
  <div class="main">
    <div class="wizard-step active" id="step0">
      <div class="intro-card">
        <h2 id="introTitle"></h2>
        <p id="introText"></p>
        <div class="highlight" id="introHighlight"></div>
      </div>
      <div class="name-section">
        <label for="userName" id="nameLabel"></label>
        <input type="text" class="name-input" id="userName" placeholder="">
      </div>
      <button class="btn-start" id="btnStart" onclick="goToStep(1)"></button>
    </div>
    <div id="questionsContainer"></div>
  </div>
</div>

<!-- RESULTS -->
<div class="results-container" id="resultsContainer">
  <div class="header">
    <div class="badge" id="rBadge"></div>
    <h1 id="resultsTitle"></h1>
    <p id="resultsDate" style="color:rgba(255,255,255,0.5);font-size:14px;margin-top:8px;position:relative;z-index:1"></p>
  </div>
  <div class="results-body" id="resultsBody"></div>
  <div class="print-watermark" id="printWatermark"></div>
  <div class="results-footer">
    <p id="rFooter"></p>
    <button class="btn-retake" id="rRetake" onclick="retake()"></button>
  </div>
</div>

<script>
// ===================== SOUND SYSTEM (Web Audio API) =====================
let soundEnabled = true;
let audioCtx = null;

function getAudioCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

function playTick() {
  if (!soundEnabled) return;
  try {
    const ctx = getAudioCtx();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.type = 'sine';
    osc.frequency.setValueAtTime(880, ctx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(1200, ctx.currentTime + 0.08);
    gain.gain.setValueAtTime(0.15, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + 0.15);
  } catch(e) {}
}

function playSelect() {
  if (!soundEnabled) return;
  try {
    const ctx = getAudioCtx();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.type = 'sine';
    osc.frequency.setValueAtTime(600, ctx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.06);
    gain.gain.setValueAtTime(0.1, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + 0.1);
  } catch(e) {}
}

function playComplete() {
  if (!soundEnabled) return;
  try {
    const ctx = getAudioCtx();
    const notes = [523.25, 659.25, 783.99, 1046.5]; // C5, E5, G5, C6
    notes.forEach((freq, i) => {
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain);
      gain.connect(ctx.destination);
      osc.type = 'sine';
      osc.frequency.setValueAtTime(freq, ctx.currentTime + i * 0.12);
      gain.gain.setValueAtTime(0, ctx.currentTime + i * 0.12);
      gain.gain.linearRampToValueAtTime(0.15, ctx.currentTime + i * 0.12 + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + i * 0.12 + 0.4);
      osc.start(ctx.currentTime + i * 0.12);
      osc.stop(ctx.currentTime + i * 0.12 + 0.4);
    });
    // Final chord
    setTimeout(() => {
      [523.25, 659.25, 783.99, 1046.5].forEach(freq => {
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.type = 'sine';
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(0.08, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.8);
        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.8);
      });
    }, 500);
  } catch(e) {}
}

function toggleSound() {
  soundEnabled = !soundEnabled;
  document.getElementById('soundToggle').innerHTML = soundEnabled
    ? 'üîä <span class="sl">ON</span>'
    : 'üîá <span class="sl">OFF</span>';
  if (soundEnabled) playSelect();
}

// ===================== 5 VOCATIONAL DIMENSIONS =====================
// C = Creative/Artistic  |  S = Scientific/Investigative  |  H = Social/Humanitarian
// B = Business/Enterprising  |  T = Technical/Practical

const i18n = {
  en: {
    hBadge: 'Vocational Assessment',
    hTitle: 'Career Aptitude Test',
    hSub: '10 questions to discover your vocational profile and ideal career paths.',
    progLabel: 'Progress', progOf: 'of',
    introTitle: 'How it works',
    introText: 'Answer 10 questions by selecting the statement that <strong>feels most like you</strong>. There are no right or wrong answers ‚Äî just be honest about what excites you.',
    introHighlight: 'Your answers map to 5 vocational dimensions: Creative, Scientific, Social, Business, and Technical. You\'ll get personalized career recommendations instantly.',
    nameLabel: 'Your Full Name', namePlaceholder: 'e.g. Mar√≠a Garc√≠a',
    btnStart: 'Start Assessment ‚Üí', btnNext: 'Next ‚Üí', btnPrev: '‚Üê Back',
    btnFinish: 'See My Results ‚Üí',
    qHint: 'Select the option that feels most like you',
    rBadge: 'Assessment Complete',
    rFooter: 'Career Aptitude Assessment ¬∑ Vocational Report',
    rRetake: '‚Üê Take Assessment Again',
    defaultName: 'Student',
    dateLocale: 'en-US',
    labels: { C:'Creative', S:'Scientific', H:'Social', B:'Business', T:'Technical' },
    radarNames: ['CREATIVE','SCIENTIFIC','SOCIAL','BUSINESS','TECHNICAL'],
    primary: 'Primary', secondary: 'Secondary',
    sections: {
      s01t:'01 ‚Äî YOUR VOCATIONAL PROFILE', s01h:'Overview',
      s02t:'02 ‚Äî APTITUDE MAP', s02h:'Score Distribution',
      s03t:'03 ‚Äî YOUR PRIMARY ORIENTATION',
      s04t:'04 ‚Äî YOUR PERSONALITY IN ACTION', s04h:'How You Think, Learn & Create',
      s05t:'05 ‚Äî YOUR STRENGTHS', s05h:'Natural Talents',
      s06t:'06 ‚Äî WATCH OUT FOR', s06h:'Potential Challenges',
      s07t:'07 ‚Äî RECOMMENDED CAREERS', s07h:'Paths That Match Your Profile',
      s08t:'08 ‚Äî IDEAL STUDY ENVIRONMENT', s08h:'',
      s09t:'09 ‚Äî DEVELOPMENT TIPS', s09h:'Advice for Your Journey',
      s10t:'10 ‚Äî YOUR IDENTITY', s10h:'Who You Are'
    },
    summaryAnchored: (name,pri,sec,eq) => `<strong>${name}</strong> shows a vocational profile anchored in the <strong>${pri}</strong> dimension${eq?`, with equally strong <strong>${sec}</strong> aptitude`:`, supported by a secondary <strong>${sec}</strong> orientation`}.`,
    summaryHigh: 'This is a highly focused vocational identity ‚Äî you know what drives you.',
    summaryMed: 'A balanced profile with clear preferences and room to explore.',
    summaryLow: 'A versatile profile ‚Äî you\'re curious about many fields, which is a strength.',
    secDepth: (sec,desc) => `Your secondary <strong>${sec}</strong> dimension adds depth: ${desc}`,
    devTip1: (s) => `<strong>Lean into your ${s} passion</strong> ‚Äî choose a major and extracurriculars that let you practice these skills daily.`,
    devTip2: (s,v) => `<strong>Explore your ${s} side</strong> (score: ${v}/10) ‚Äî even if it's not your top dimension, it could complement your primary path in surprising ways.`,
    devTip3: '<strong>Talk to professionals</strong> ‚Äî reach out to people working in fields you\'re considering. Real conversations are worth more than any test.',
    finalIs: (name,pri,sec,id) => `<strong>${name}</strong> has a <strong>${pri}-${sec}</strong> vocational profile ‚Äî ${id}`,
    shareTitle: 'Share Your Results', shareSub: 'Print or share your vocational profile.',
    sharePrint: 'Print / PDF', shareWhatsapp: 'Share via WhatsApp',
    shareWABody: (name,pri,sec,ps,ss,summary) => `üéì *Career Aptitude Test*%0A%0Aüë§ *${name}*%0AüèÜ Primary: *${pri}* (${ps}/10)%0Aü•à Secondary: *${sec}* (${ss}/10)%0A%0A${summary}%0A%0A‚úÖ Take the test yourself!%0Aüîó https://testvocacion.netlify.app/`,
    questions: [
      { q:"On a free Saturday, I'd rather‚Ä¶", a:[
        {text:"Draw, write, play music, or work on a creative project",style:"C"},
        {text:"Watch a documentary, do experiments, or research something fascinating",style:"S"},
        {text:"Volunteer, help a friend with a problem, or organize a group activity",style:"H"},
        {text:"Work on a business idea, sell something, or plan an event",style:"B"},
        {text:"Build or fix something with my hands, code, or tinker with gadgets",style:"T"}
      ]},
      { q:"In a group project at school, I naturally‚Ä¶", a:[
        {text:"Come up with the concept, design, and visual presentation",style:"C"},
        {text:"Do the research, analyze data, and make sure facts are correct",style:"S"},
        {text:"Make sure everyone is included and resolve any conflicts",style:"H"},
        {text:"Take charge, delegate tasks, and keep the team on deadline",style:"B"},
        {text:"Handle the technical parts ‚Äî spreadsheets, tools, or building the prototype",style:"T"}
      ]},
      { q:"The subject I enjoy most (or would enjoy most) is‚Ä¶", a:[
        {text:"Art, music, literature, film, or creative writing",style:"C"},
        {text:"Biology, chemistry, physics, or mathematics",style:"S"},
        {text:"Psychology, sociology, history, or philosophy",style:"H"},
        {text:"Economics, business, law, or political science",style:"B"},
        {text:"Computer science, engineering, robotics, or shop class",style:"T"}
      ]},
      { q:"When I imagine my future career, I see myself‚Ä¶", a:[
        {text:"Expressing ideas through design, art, writing, or performance",style:"C"},
        {text:"Discovering things ‚Äî researching, experimenting, solving mysteries",style:"S"},
        {text:"Helping people directly ‚Äî teaching, counseling, healing, or advocating",style:"H"},
        {text:"Leading a company, managing projects, or closing deals",style:"B"},
        {text:"Building things ‚Äî coding apps, designing systems, or engineering solutions",style:"T"}
      ]},
      { q:"I feel most accomplished when I‚Ä¶", a:[
        {text:"Create something original that others appreciate",style:"C"},
        {text:"Figure out how or why something works",style:"S"},
        {text:"Make someone's day better or help solve a personal problem",style:"H"},
        {text:"Achieve a goal, win a competition, or earn money from my efforts",style:"B"},
        {text:"Complete a hands-on project or make something work properly",style:"T"}
      ]},
      { q:"My friends would describe me as‚Ä¶", a:[
        {text:"Imaginative, original, and a bit of a dreamer",style:"C"},
        {text:"Curious, analytical, and always asking 'why?'",style:"S"},
        {text:"Empathetic, a good listener, and someone people trust",style:"H"},
        {text:"Ambitious, persuasive, and a natural leader",style:"B"},
        {text:"Practical, resourceful, and great at fixing things",style:"T"}
      ]},
      { q:"If I could have any superpower, it would be‚Ä¶", a:[
        {text:"The ability to bring any idea I imagine to life instantly",style:"C"},
        {text:"The ability to understand any system or phenomenon completely",style:"S"},
        {text:"The ability to heal anyone's emotional or physical pain",style:"H"},
        {text:"The ability to convince anyone of anything",style:"B"},
        {text:"The ability to build any machine or technology I can think of",style:"T"}
      ]},
      { q:"When learning something new, I prefer to‚Ä¶", a:[
        {text:"Explore freely, experiment, and find my own creative approach",style:"C"},
        {text:"Read deeply, take notes, analyze patterns, and ask tough questions",style:"S"},
        {text:"Discuss with others, hear different perspectives, and connect it to people",style:"H"},
        {text:"Focus on how to apply it practically to achieve a specific goal",style:"B"},
        {text:"Get hands-on immediately ‚Äî try it, test it, build it",style:"T"}
      ]},
      { q:"The kind of workplace I'd thrive in is‚Ä¶", a:[
        {text:"A studio, gallery, or creative agency with flexible hours",style:"C"},
        {text:"A lab, university, or research center surrounded by experts",style:"S"},
        {text:"A school, hospital, NGO, or community organization",style:"H"},
        {text:"A corporate office, startup, or my own business",style:"B"},
        {text:"A workshop, tech company, construction site, or engineering firm",style:"T"}
      ]},
      { q:"The problem I'd most want to solve in the world is‚Ä¶", a:[
        {text:"Making culture, art, and beauty more accessible to everyone",style:"C"},
        {text:"Curing diseases, understanding the universe, or advancing science",style:"S"},
        {text:"Reducing inequality, improving education, or fighting injustice",style:"H"},
        {text:"Creating economic opportunities and building thriving businesses",style:"B"},
        {text:"Building better infrastructure, technology, or sustainable systems",style:"T"}
      ]}
    ],
    profiles: {
      C: {
        title:'The Creative / Artistic',
        desc:'You are driven by the need to express, create, and bring ideas to life. Your mind works in images, stories, sounds, and feelings. You see the world differently and want to share that vision.',
        dna:'You think in non-linear ways ‚Äî connecting ideas that others don\'t see. You\'re motivated by beauty, originality, and emotional truth. Routine bores you; you need freedom to explore and create.',
        strengths:['Original thinking','Visual/spatial intelligence','Emotional expression','Aesthetic sensitivity','Storytelling ability','Creative problem-solving'],
        blindspots:['May struggle with rigid structure','Can procrastinate on "boring" tasks','May undervalue commercial viability','Sensitive to criticism of creative work'],
        careers:[
          {name:'Graphic Design',sub:'Branding, UX/UI, web design'},
          {name:'Architecture',sub:'Building + artistic vision'},
          {name:'Film & Media',sub:'Directing, production, animation'},
          {name:'Marketing Creative',sub:'Content, copywriting, campaigns'},
          {name:'Music / Performing Arts',sub:'Performance, composition, production'},
          {name:'Fashion Design',sub:'Textile, styling, product design'}
        ],
        environment:'You thrive in flexible, visually stimulating environments with minimal bureaucracy. Studios, agencies, and independent work suit you best.',
      },
      S: {
        title:'The Scientific / Investigative',
        desc:'You are driven by curiosity, evidence, and the desire to understand how things work. You love asking "why?" and won\'t rest until you find a solid answer backed by data.',
        dna:'You think analytically and systematically. You\'re motivated by discovery and intellectual challenge. Abstract concepts excite you, and you enjoy working with numbers, patterns, and theories.',
        strengths:['Analytical reasoning','Research methodology','Critical thinking','Pattern recognition','Data interpretation','Intellectual persistence'],
        blindspots:['May overthink decisions','Can seem detached or too theoretical','May struggle with ambiguity in social situations','Perfectionism can slow progress'],
        careers:[
          {name:'Medicine',sub:'Doctor, researcher, specialist'},
          {name:'Data Science / AI',sub:'Machine learning, analytics'},
          {name:'Biotechnology',sub:'Genetics, pharma, bioengineering'},
          {name:'Physics / Mathematics',sub:'Research, academia, applied science'},
          {name:'Environmental Science',sub:'Climate, ecology, sustainability'},
          {name:'Psychology (Research)',sub:'Neuroscience, cognitive science'}
        ],
        environment:'You thrive in intellectual environments with access to resources, labs, libraries, and peers who challenge your thinking. Universities and research institutions are ideal.',
      },
      H: {
        title:'The Social / Humanitarian',
        desc:'You are driven by the desire to help, heal, educate, and connect with others. People\'s wellbeing matters deeply to you, and you feel most alive when making a meaningful difference.',
        dna:'You think empathetically ‚Äî always considering how others feel. You\'re motivated by impact, justice, and human connection. Listening comes naturally, and you build trust quickly.',
        strengths:['Empathy & emotional intelligence','Active listening','Conflict resolution','Teaching & mentoring','Community building','Cultural sensitivity'],
        blindspots:['May absorb others\' stress','Can prioritize others\' needs over your own','May struggle with tough decisions that hurt people','Risk of burnout from emotional labor'],
        careers:[
          {name:'Medicine (Clinical)',sub:'Doctor, nurse, therapist'},
          {name:'Psychology (Clinical)',sub:'Counselor, therapist, coach'},
          {name:'Education',sub:'Teacher, professor, curriculum designer'},
          {name:'Social Work',sub:'Community development, NGOs'},
          {name:'Law (Human Rights)',sub:'Advocacy, public interest, policy'},
          {name:'International Relations',sub:'Diplomacy, development, humanitarian aid'}
        ],
        environment:'You thrive in collaborative, people-centered environments where relationships matter. Schools, hospitals, nonprofits, and community organizations are where you shine.',
      },
      B: {
        title:'The Business / Enterprising',
        desc:'You are driven by achievement, influence, and the thrill of turning ideas into reality. You see opportunities where others see obstacles, and you\'re not afraid to take calculated risks.',
        dna:'You think strategically ‚Äî always weighing costs, benefits, and competitive advantage. You\'re motivated by results, recognition, and financial independence. Natural persuader and negotiator.',
        strengths:['Strategic thinking','Persuasion & negotiation','Decision-making under pressure','Financial literacy','Leadership presence','Opportunity recognition'],
        blindspots:['May prioritize winning over relationships','Can be impatient with process','May take excessive risks','Can struggle to delegate control'],
        careers:[
          {name:'Business Administration',sub:'Management, consulting, operations'},
          {name:'Entrepreneurship',sub:'Startups, product development'},
          {name:'Finance',sub:'Investment banking, venture capital'},
          {name:'Marketing & Sales',sub:'Strategy, brand management'},
          {name:'Law (Corporate)',sub:'M&A, contracts, compliance'},
          {name:'International Business',sub:'Trade, imports/exports, global strategy'}
        ],
        environment:'You thrive in competitive, fast-paced environments with clear goals and rewards. Startups, corporations, and your own ventures are where you excel.',
      },
      T: {
        title:'The Technical / Practical',
        desc:'You are driven by the satisfaction of building, fixing, and making things work. You trust your hands as much as your mind, and you prefer doing over theorizing.',
        dna:'You think in systems and processes ‚Äî understanding how parts connect to make a whole. You\'re motivated by tangible results and functional excellence. If it\'s broken, you want to fix it.',
        strengths:['Hands-on problem-solving','Systems thinking','Technical precision','Spatial reasoning','Logical troubleshooting','Practical efficiency'],
        blindspots:['May undervalue soft skills','Can struggle with abstract or theoretical work','May resist change if current system works','Communication can be too technical'],
        careers:[
          {name:'Software Engineering',sub:'Full-stack, mobile, DevOps'},
          {name:'Civil Engineering',sub:'Infrastructure, construction'},
          {name:'Industrial Engineering',sub:'Manufacturing, optimization'},
          {name:'Cybersecurity',sub:'Network security, ethical hacking'},
          {name:'Mechanical Engineering',sub:'Automotive, aerospace, robotics'},
          {name:'IT & Systems',sub:'Cloud, databases, network administration'}
        ],
        environment:'You thrive in hands-on environments with real problems to solve. Tech companies, engineering firms, labs, and workshops are your natural habitat.',
      }
    },
    identity: {
      'CS':'a creative scientist who blends artistic vision with analytical rigor.',
      'CH':'an empathetic creator who uses art and design to uplift people.',
      'CB':'a creative entrepreneur who turns original ideas into profitable ventures.',
      'CT':'a design engineer who merges aesthetics with technical precision.',
      'SC':'a visionary researcher who approaches science with creative intuition.',
      'SH':'a compassionate scientist who uses knowledge to help humanity.',
      'SB':'a data-driven strategist who turns research into business advantage.',
      'ST':'a technical researcher who bridges theory and practical application.',
      'HC':'an artistic healer who uses creativity to connect and inspire.',
      'HS':'an evidence-based helper who combines empathy with scientific rigor.',
      'HB':'a social entrepreneur who builds organizations that change lives.',
      'HT':'a practical humanitarian who builds systems that serve people.',
      'BC':'an innovative business leader who brings creativity to strategy.',
      'BS':'an analytical entrepreneur who makes decisions backed by data.',
      'BH':'a purpose-driven leader who builds businesses that serve communities.',
      'BT':'a technical business leader who scales operations through technology.',
      'TC':'a creative technologist who builds beautiful, functional solutions.',
      'TS':'a scientific engineer who pushes the boundaries of what\'s possible.',
      'TH':'a technology humanist who builds tools that empower people.',
      'TB':'a tech entrepreneur who turns engineering skills into business success.',
      'default':'a versatile person with diverse aptitudes ready to explore many paths.'
    }
  },
  es: {
    hBadge: 'Test Vocacional',
    hTitle: 'Test de Aptitud Vocacional',
    hSub: '10 preguntas para descubrir tu perfil vocacional y las carreras ideales para ti.',
    progLabel: 'Progreso', progOf: 'de',
    introTitle: 'C√≥mo funciona',
    introText: 'Responde 10 preguntas seleccionando la opci√≥n que <strong>m√°s se parece a ti</strong>. No hay respuestas correctas ni incorrectas ‚Äî solo s√© honesto sobre lo que te emociona.',
    introHighlight: 'Tus respuestas se mapean a 5 dimensiones vocacionales: Creativo, Cient√≠fico, Social, Negocios y T√©cnico. Recibir√°s recomendaciones de carreras al instante.',
    nameLabel: 'Tu Nombre Completo', namePlaceholder: 'ej. Mar√≠a Garc√≠a',
    btnStart: 'Comenzar Test ‚Üí', btnNext: 'Siguiente ‚Üí', btnPrev: '‚Üê Atr√°s',
    btnFinish: 'Ver Mis Resultados ‚Üí',
    qHint: 'Selecciona la opci√≥n que m√°s se parece a ti',
    rBadge: 'Test Completado',
    rFooter: 'Test de Aptitud Vocacional ¬∑ Reporte de Orientaci√≥n',
    rRetake: '‚Üê Hacer el Test de Nuevo',
    defaultName: 'Estudiante',
    dateLocale: 'es-ES',
    labels: { C:'Creativo', S:'Cient√≠fico', H:'Social', B:'Negocios', T:'T√©cnico' },
    radarNames: ['CREATIVO','CIENT√çFICO','SOCIAL','NEGOCIOS','T√âCNICO'],
    primary: 'Primario', secondary: 'Secundario',
    sections: {
      s01t:'01 ‚Äî TU PERFIL VOCACIONAL', s01h:'Panorama General',
      s02t:'02 ‚Äî MAPA DE APTITUDES', s02h:'Distribuci√≥n de Puntajes',
      s03t:'03 ‚Äî TU ORIENTACI√ìN PRINCIPAL',
      s04t:'04 ‚Äî TU PERSONALIDAD EN ACCI√ìN', s04h:'C√≥mo Piensas, Aprendes y Creas',
      s05t:'05 ‚Äî TUS FORTALEZAS', s05h:'Talentos Naturales',
      s06t:'06 ‚Äî PUNTOS DE ATENCI√ìN', s06h:'Desaf√≠os Potenciales',
      s07t:'07 ‚Äî CARRERAS RECOMENDADAS', s07h:'Caminos que Encajan con Tu Perfil',
      s08t:'08 ‚Äî AMBIENTE IDEAL DE ESTUDIO', s08h:'',
      s09t:'09 ‚Äî CONSEJOS DE DESARROLLO', s09h:'Para Tu Camino',
      s10t:'10 ‚Äî TU IDENTIDAD', s10h:'Qui√©n Eres'
    },
    summaryAnchored: (name,pri,sec,eq) => `<strong>${name}</strong> muestra un perfil vocacional anclado en la dimensi√≥n <strong>${pri}</strong>${eq?`, con aptitud igualmente fuerte en <strong>${sec}</strong>`:`, apoyado por una orientaci√≥n secundaria <strong>${sec}</strong>`}.`,
    summaryHigh: 'Este es un perfil vocacional altamente enfocado ‚Äî sabes lo que te impulsa.',
    summaryMed: 'Un perfil equilibrado con preferencias claras y espacio para explorar.',
    summaryLow: 'Un perfil vers√°til ‚Äî tienes curiosidad por muchos campos, lo cual es una fortaleza.',
    secDepth: (sec,desc) => `Tu dimensi√≥n secundaria <strong>${sec}</strong> agrega profundidad: ${desc}`,
    devTip1: (s) => `<strong>Ap√≥yate en tu pasi√≥n ${s}</strong> ‚Äî elige una carrera y actividades extracurriculares que te permitan practicar estas habilidades a diario.`,
    devTip2: (s,v) => `<strong>Explora tu lado ${s}</strong> (puntaje: ${v}/10) ‚Äî aunque no sea tu dimensi√≥n principal, podr√≠a complementar tu camino de formas sorprendentes.`,
    devTip3: '<strong>Habla con profesionales</strong> ‚Äî contacta personas que trabajan en campos que te interesan. Las conversaciones reales valen m√°s que cualquier test.',
    finalIs: (name,pri,sec,id) => `<strong>${name}</strong> tiene un perfil vocacional <strong>${pri}-${sec}</strong> ‚Äî ${id}`,
    shareTitle: 'Comparte Tus Resultados', shareSub: 'Imprime o comparte tu perfil vocacional.',
    sharePrint: 'Imprimir / PDF', shareWhatsapp: 'Compartir por WhatsApp',
    shareWABody: (name,pri,sec,ps,ss,summary) => `üéì *Test de Aptitud Vocacional*%0A%0Aüë§ *${name}*%0AüèÜ Primario: *${pri}* (${ps}/10)%0Aü•à Secundario: *${sec}* (${ss}/10)%0A%0A${summary}%0A%0A‚úÖ ¬°Haz el test t√∫ tambi√©n!%0Aüîó https://testvocacion.netlify.app/`,
    questions: [
      { q:"Un s√°bado libre, preferir√≠a‚Ä¶", a:[
        {text:"Dibujar, escribir, tocar m√∫sica o trabajar en un proyecto creativo",style:"C"},
        {text:"Ver un documental, hacer experimentos o investigar algo fascinante",style:"S"},
        {text:"Hacer voluntariado, ayudar a un amigo o organizar una actividad grupal",style:"H"},
        {text:"Trabajar en una idea de negocio, vender algo o planificar un evento",style:"B"},
        {text:"Construir o arreglar algo con mis manos, programar o experimentar con gadgets",style:"T"}
      ]},
      { q:"En un trabajo en grupo del colegio, naturalmente yo‚Ä¶", a:[
        {text:"Creo el concepto, el dise√±o y la presentaci√≥n visual",style:"C"},
        {text:"Hago la investigaci√≥n, analizo datos y verifico los hechos",style:"S"},
        {text:"Me aseguro de que todos participen y resuelvo cualquier conflicto",style:"H"},
        {text:"Tomo el liderazgo, delego tareas y mantengo al equipo en plazo",style:"B"},
        {text:"Me encargo de la parte t√©cnica ‚Äî hojas de c√°lculo, herramientas o el prototipo",style:"T"}
      ]},
      { q:"La materia que m√°s disfruto (o disfrutar√≠a) es‚Ä¶", a:[
        {text:"Arte, m√∫sica, literatura, cine o escritura creativa",style:"C"},
        {text:"Biolog√≠a, qu√≠mica, f√≠sica o matem√°ticas",style:"S"},
        {text:"Psicolog√≠a, sociolog√≠a, historia o filosof√≠a",style:"H"},
        {text:"Econom√≠a, administraci√≥n, derecho o ciencias pol√≠ticas",style:"B"},
        {text:"Inform√°tica, ingenier√≠a, rob√≥tica o taller de tecnolog√≠a",style:"T"}
      ]},
      { q:"Cuando imagino mi futuro profesional, me veo‚Ä¶", a:[
        {text:"Expresando ideas a trav√©s del dise√±o, arte, escritura o actuaci√≥n",style:"C"},
        {text:"Descubriendo cosas ‚Äî investigando, experimentando, resolviendo misterios",style:"S"},
        {text:"Ayudando a personas directamente ‚Äî ense√±ando, sanando o abogando por otros",style:"H"},
        {text:"Liderando una empresa, gestionando proyectos o cerrando negocios",style:"B"},
        {text:"Construyendo cosas ‚Äî programando apps, dise√±ando sistemas o creando soluciones",style:"T"}
      ]},
      { q:"Me siento m√°s realizado/a cuando‚Ä¶", a:[
        {text:"Creo algo original que otros aprecian",style:"C"},
        {text:"Descubro c√≥mo o por qu√© algo funciona",style:"S"},
        {text:"Hago que el d√≠a de alguien sea mejor o ayudo con un problema personal",style:"H"},
        {text:"Logro una meta, gano una competencia o gano dinero con mi esfuerzo",style:"B"},
        {text:"Completo un proyecto pr√°ctico o hago que algo funcione correctamente",style:"T"}
      ]},
      { q:"Mis amigos me describir√≠an como‚Ä¶", a:[
        {text:"Imaginativo/a, original y un poco so√±ador/a",style:"C"},
        {text:"Curioso/a, anal√≠tico/a y siempre preguntando '¬øpor qu√©?'",style:"S"},
        {text:"Emp√°tico/a, buen/a oyente y alguien en quien confiar",style:"H"},
        {text:"Ambicioso/a, persuasivo/a y l√≠der natural",style:"B"},
        {text:"Pr√°ctico/a, ingenioso/a y bueno/a arreglando cosas",style:"T"}
      ]},
      { q:"Si pudiera tener un superpoder, ser√≠a‚Ä¶", a:[
        {text:"Dar vida instant√°nea a cualquier idea que imagine",style:"C"},
        {text:"Comprender completamente cualquier sistema o fen√≥meno",style:"S"},
        {text:"Sanar el dolor emocional o f√≠sico de cualquier persona",style:"H"},
        {text:"Convencer a cualquier persona de lo que sea",style:"B"},
        {text:"Construir cualquier m√°quina o tecnolog√≠a que pueda pensar",style:"T"}
      ]},
      { q:"Cuando aprendo algo nuevo, prefiero‚Ä¶", a:[
        {text:"Explorar libremente, experimentar y encontrar mi propio enfoque creativo",style:"C"},
        {text:"Leer a fondo, tomar notas, analizar patrones y hacer preguntas dif√≠ciles",style:"S"},
        {text:"Discutir con otros, escuchar perspectivas diferentes y conectarlo con personas",style:"H"},
        {text:"Enfocarme en c√≥mo aplicarlo pr√°cticamente para lograr un objetivo",style:"B"},
        {text:"Meterme de lleno ‚Äî probarlo, testearlo, construirlo",style:"T"}
      ]},
      { q:"El tipo de lugar donde me gustar√≠a trabajar es‚Ä¶", a:[
        {text:"Un estudio, galer√≠a o agencia creativa con horarios flexibles",style:"C"},
        {text:"Un laboratorio, universidad o centro de investigaci√≥n rodeado de expertos",style:"S"},
        {text:"Una escuela, hospital, ONG u organizaci√≥n comunitaria",style:"H"},
        {text:"Una oficina corporativa, startup o mi propio negocio",style:"B"},
        {text:"Un taller, empresa tecnol√≥gica, obra de construcci√≥n o firma de ingenier√≠a",style:"T"}
      ]},
      { q:"El problema que m√°s me gustar√≠a resolver en el mundo es‚Ä¶", a:[
        {text:"Hacer la cultura, el arte y la belleza m√°s accesibles para todos",style:"C"},
        {text:"Curar enfermedades, entender el universo o avanzar la ciencia",style:"S"},
        {text:"Reducir la desigualdad, mejorar la educaci√≥n o luchar contra la injusticia",style:"H"},
        {text:"Crear oportunidades econ√≥micas y construir negocios pr√≥speros",style:"B"},
        {text:"Construir mejor infraestructura, tecnolog√≠a o sistemas sostenibles",style:"T"}
      ]}
    ],
    profiles: {
      C: {
        title:'El Perfil Creativo / Art√≠stico',
        desc:'Te impulsa la necesidad de expresarte, crear y dar vida a las ideas. Tu mente trabaja con im√°genes, historias, sonidos y emociones. Ves el mundo diferente y quieres compartir esa visi√≥n.',
        dna:'Piensas de formas no lineales ‚Äî conectando ideas que otros no ven. Te motiva la belleza, la originalidad y la verdad emocional. La rutina te aburre; necesitas libertad para explorar y crear.',
        strengths:['Pensamiento original','Inteligencia visual/espacial','Expresi√≥n emocional','Sensibilidad est√©tica','Capacidad narrativa','Resoluci√≥n creativa de problemas'],
        blindspots:['Puede costar adaptarse a estructuras r√≠gidas','Tendencia a procrastinar en tareas "aburridas"','Puede subestimar la viabilidad comercial','Sensibilidad a la cr√≠tica del trabajo creativo'],
        careers:[
          {name:'Dise√±o Gr√°fico',sub:'Branding, UX/UI, dise√±o web'},
          {name:'Arquitectura',sub:'Construcci√≥n + visi√≥n art√≠stica'},
          {name:'Cine y Medios',sub:'Direcci√≥n, producci√≥n, animaci√≥n'},
          {name:'Marketing Creativo',sub:'Contenido, copywriting, campa√±as'},
          {name:'M√∫sica / Artes Esc√©nicas',sub:'Performance, composici√≥n, producci√≥n'},
          {name:'Dise√±o de Moda',sub:'Textil, styling, dise√±o de producto'}
        ],
        environment:'Prosperas en ambientes flexibles, visualmente estimulantes y con poca burocracia. Estudios, agencias y trabajo independiente te sientan mejor.',
      },
      S: {
        title:'El Perfil Cient√≠fico / Investigador',
        desc:'Te impulsa la curiosidad, la evidencia y el deseo de entender c√≥mo funcionan las cosas. Te encanta preguntar "¬øpor qu√©?" y no descansas hasta encontrar una respuesta s√≥lida respaldada por datos.',
        dna:'Piensas de forma anal√≠tica y sistem√°tica. Te motiva el descubrimiento y el desaf√≠o intelectual. Los conceptos abstractos te emocionan y disfrutas trabajar con n√∫meros, patrones y teor√≠as.',
        strengths:['Razonamiento anal√≠tico','Metodolog√≠a de investigaci√≥n','Pensamiento cr√≠tico','Reconocimiento de patrones','Interpretaci√≥n de datos','Persistencia intelectual'],
        blindspots:['Puede sobre-pensar las decisiones','Puede parecer distante o muy te√≥rico','Puede tener dificultad con la ambig√ºedad social','El perfeccionismo puede frenar el progreso'],
        careers:[
          {name:'Medicina',sub:'Doctor, investigador, especialista'},
          {name:'Ciencia de Datos / IA',sub:'Machine learning, anal√≠tica'},
          {name:'Biotecnolog√≠a',sub:'Gen√©tica, farmac√©utica, bioingenier√≠a'},
          {name:'F√≠sica / Matem√°ticas',sub:'Investigaci√≥n, academia, ciencia aplicada'},
          {name:'Ciencias Ambientales',sub:'Clima, ecolog√≠a, sostenibilidad'},
          {name:'Psicolog√≠a (Investigaci√≥n)',sub:'Neurociencia, ciencia cognitiva'}
        ],
        environment:'Prosperas en ambientes intelectuales con acceso a recursos, laboratorios, bibliotecas y compa√±eros que desaf√≠en tu pensamiento.',
      },
      H: {
        title:'El Perfil Social / Humanitario',
        desc:'Te impulsa el deseo de ayudar, sanar, educar y conectar con otros. El bienestar de las personas te importa profundamente y te sientes m√°s vivo cuando haces una diferencia significativa.',
        dna:'Piensas emp√°ticamente ‚Äî siempre considerando c√≥mo se sienten los dem√°s. Te motiva el impacto, la justicia y la conexi√≥n humana. Escuchar te sale natural y construyes confianza r√°pidamente.',
        strengths:['Empat√≠a e inteligencia emocional','Escucha activa','Resoluci√≥n de conflictos','Ense√±anza y mentor√≠a','Construcci√≥n de comunidad','Sensibilidad cultural'],
        blindspots:['Puede absorber el estr√©s de otros','Puede priorizar necesidades ajenas sobre las propias','Puede tener dificultad con decisiones que lastiman','Riesgo de agotamiento por labor emocional'],
        careers:[
          {name:'Medicina (Cl√≠nica)',sub:'Doctor, enfermero/a, terapeuta'},
          {name:'Psicolog√≠a (Cl√≠nica)',sub:'Consejero, terapeuta, coach'},
          {name:'Educaci√≥n',sub:'Maestro/a, profesor/a, dise√±o curricular'},
          {name:'Trabajo Social',sub:'Desarrollo comunitario, ONGs'},
          {name:'Derecho (Derechos Humanos)',sub:'Advocacy, inter√©s p√∫blico, pol√≠tica'},
          {name:'Relaciones Internacionales',sub:'Diplomacia, desarrollo, ayuda humanitaria'}
        ],
        environment:'Prosperas en ambientes colaborativos centrados en personas donde las relaciones importan. Escuelas, hospitales, ONGs y organizaciones comunitarias son donde brillas.',
      },
      B: {
        title:'El Perfil de Negocios / Emprendedor',
        desc:'Te impulsa el logro, la influencia y la emoci√≥n de convertir ideas en realidad. Ves oportunidades donde otros ven obst√°culos y no temes tomar riesgos calculados.',
        dna:'Piensas estrat√©gicamente ‚Äî siempre evaluando costos, beneficios y ventaja competitiva. Te motivan los resultados, el reconocimiento y la independencia financiera. Persuasor y negociador natural.',
        strengths:['Pensamiento estrat√©gico','Persuasi√≥n y negociaci√≥n','Toma de decisiones bajo presi√≥n','Inteligencia financiera','Presencia de liderazgo','Reconocimiento de oportunidades'],
        blindspots:['Puede priorizar ganar sobre las relaciones','Puede ser impaciente con los procesos','Puede tomar riesgos excesivos','Puede costarle delegar el control'],
        careers:[
          {name:'Administraci√≥n de Empresas',sub:'Gesti√≥n, consultor√≠a, operaciones'},
          {name:'Emprendimiento',sub:'Startups, desarrollo de productos'},
          {name:'Finanzas',sub:'Banca de inversi√≥n, capital de riesgo'},
          {name:'Marketing y Ventas',sub:'Estrategia, gesti√≥n de marca'},
          {name:'Derecho (Corporativo)',sub:'Fusiones, contratos, cumplimiento'},
          {name:'Negocios Internacionales',sub:'Comercio, importaciones, estrategia global'}
        ],
        environment:'Prosperas en ambientes competitivos y r√°pidos con metas y recompensas claras. Startups, corporaciones y tus propios emprendimientos son donde sobresales.',
      },
      T: {
        title:'El Perfil T√©cnico / Pr√°ctico',
        desc:'Te impulsa la satisfacci√≥n de construir, arreglar y hacer que las cosas funcionen. Conf√≠as en tus manos tanto como en tu mente y prefieres hacer antes que teorizar.',
        dna:'Piensas en sistemas y procesos ‚Äî entendiendo c√≥mo las partes se conectan para formar un todo. Te motivan los resultados tangibles y la excelencia funcional. Si algo est√° roto, quieres arreglarlo.',
        strengths:['Resoluci√≥n pr√°ctica de problemas','Pensamiento sist√©mico','Precisi√≥n t√©cnica','Razonamiento espacial','Depuraci√≥n l√≥gica','Eficiencia pr√°ctica'],
        blindspots:['Puede subestimar las habilidades blandas','Puede tener dificultad con trabajo abstracto o te√≥rico','Puede resistir el cambio si el sistema actual funciona','La comunicaci√≥n puede ser demasiado t√©cnica'],
        careers:[
          {name:'Ingenier√≠a de Software',sub:'Full-stack, m√≥vil, DevOps'},
          {name:'Ingenier√≠a Civil',sub:'Infraestructura, construcci√≥n'},
          {name:'Ingenier√≠a Industrial',sub:'Manufactura, optimizaci√≥n'},
          {name:'Ciberseguridad',sub:'Seguridad de redes, hacking √©tico'},
          {name:'Ingenier√≠a Mec√°nica',sub:'Automotriz, aeroespacial, rob√≥tica'},
          {name:'IT y Sistemas',sub:'Cloud, bases de datos, redes'}
        ],
        environment:'Prosperas en ambientes pr√°cticos con problemas reales que resolver. Empresas tech, firmas de ingenier√≠a, laboratorios y talleres son tu h√°bitat natural.',
      }
    },
    identity: {
      'CS':'un cient√≠fico creativo que combina visi√≥n art√≠stica con rigor anal√≠tico.',
      'CH':'un creador emp√°tico que usa el arte y el dise√±o para inspirar a las personas.',
      'CB':'un emprendedor creativo que convierte ideas originales en negocios exitosos.',
      'CT':'un ingeniero de dise√±o que fusiona est√©tica con precisi√≥n t√©cnica.',
      'SC':'un investigador visionario que aborda la ciencia con intuici√≥n creativa.',
      'SH':'un cient√≠fico compasivo que usa el conocimiento para ayudar a la humanidad.',
      'SB':'un estratega basado en datos que convierte la investigaci√≥n en ventaja de negocio.',
      'ST':'un investigador t√©cnico que conecta la teor√≠a con la aplicaci√≥n pr√°ctica.',
      'HC':'un sanador art√≠stico que usa la creatividad para conectar e inspirar.',
      'HS':'un ayudante basado en evidencia que combina empat√≠a con rigor cient√≠fico.',
      'HB':'un emprendedor social que construye organizaciones que cambian vidas.',
      'HT':'un humanitario pr√°ctico que construye sistemas que sirven a las personas.',
      'BC':'un l√≠der de negocios innovador que aporta creatividad a la estrategia.',
      'BS':'un emprendedor anal√≠tico que toma decisiones respaldadas por datos.',
      'BH':'un l√≠der con prop√≥sito que construye negocios que sirven a comunidades.',
      'BT':'un l√≠der t√©cnico de negocios que escala operaciones a trav√©s de la tecnolog√≠a.',
      'TC':'un tecn√≥logo creativo que construye soluciones bellas y funcionales.',
      'TS':'un ingeniero cient√≠fico que empuja los l√≠mites de lo posible.',
      'TH':'un humanista tecnol√≥gico que construye herramientas que empoderan personas.',
      'TB':'un emprendedor tech que convierte habilidades de ingenier√≠a en √©xito empresarial.',
      'default':'una persona vers√°til con aptitudes diversas lista para explorar muchos caminos.'
    }
  }
};

// ===================== STATE =====================
let LANG = 'en';
let currentStep = 0;
const answers = {};
const colors = { C:'var(--c1)', S:'var(--c2)', H:'var(--c3)', B:'var(--c4)', T:'var(--c5)' };
const colorHex = { C:'#6C5CE7', S:'#00B894', H:'#FDCB6E', B:'#E17055', T:'#0984E3' };

function t() { return i18n[LANG]; }

function startAssessment(lang) {
  LANG = lang;
  document.getElementById('langScreen').classList.add('hidden');
  document.getElementById('formContainer').classList.add('visible');
  buildForm();
}

function switchLang() {
  LANG = LANG === 'en' ? 'es' : 'en';
  const savedName = document.getElementById('userName').value;
  const savedAnswers = { ...answers };
  const savedStep = currentStep;
  buildForm();
  document.getElementById('userName').value = savedName;
  Object.entries(savedAnswers).forEach(([qi, style]) => {
    const card = document.getElementById('qcard' + qi);
    if (!card) return;
    card.querySelectorAll('.q-option').forEach(o => {
      if (o.dataset.style === style) { o.classList.add('selected'); card.classList.add('answered'); answers[qi] = style; }
    });
    const btn = document.getElementById('btnNext' + qi);
    if (btn) btn.disabled = false;
  });
  goToStep(savedStep);
}

function buildForm() {
  const L = t();
  document.getElementById('hBadge').textContent = L.hBadge;
  document.getElementById('hTitle').textContent = L.hTitle;
  document.getElementById('hSub').textContent = L.hSub;
  document.getElementById('progLabel').textContent = L.progLabel;
  document.getElementById('introTitle').textContent = L.introTitle;
  document.getElementById('introText').innerHTML = L.introText;
  document.getElementById('introHighlight').textContent = L.introHighlight;
  document.getElementById('nameLabel').textContent = L.nameLabel;
  document.getElementById('userName').placeholder = L.namePlaceholder;
  document.getElementById('btnStart').textContent = L.btnStart;
  document.getElementById('langSwitchBtn').textContent = LANG === 'en' ? 'üåê Espa√±ol' : 'üåê English';
  currentStep = 0;
  updateProgress();
  buildQuestions();
  showStep(0);
}

function buildQuestions() {
  const container = document.getElementById('questionsContainer');
  container.innerHTML = '';
  const L = t();
  L.questions.forEach((q, qi) => {
    const shuffled = q.a.map(a => ({ ...a })).sort(() => Math.random() - 0.5);
    const isLast = qi === 9;
    let html = `<div class="wizard-step" id="step${qi+1}">
      <div class="q-card" id="qcard${qi}">
        <div class="q-header"><div class="q-num">${qi+1}</div><div class="q-text">${q.q}</div></div>
        <div class="q-options">`;
    shuffled.forEach(a => {
      html += `<div class="q-option" data-style="${a.style}" onclick="selectOpt(${qi},this,'${a.style}')">
        <div class="q-radio"></div><span class="q-option-text">${a.text}</span></div>`;
    });
    html += `</div></div>
      <p class="q-hint">${L.qHint}</p>
      <div class="nav-buttons" style="justify-content:flex-end;">
        <button class="btn-nav btn-next" id="btnNext${qi}" onclick="${isLast ? 'submitForm()' : `goToStep(${qi+2})`}" disabled>${isLast ? L.btnFinish : L.btnNext}</button>
      </div></div>`;
    container.innerHTML += html;
  });
}

function selectOpt(qi, el, style) {
  const card = document.getElementById('qcard' + qi);
  card.querySelectorAll('.q-option').forEach(o => o.classList.remove('selected'));
  el.classList.add('selected');
  card.classList.add('answered');
  answers[qi] = style;
  const btn = document.getElementById('btnNext' + qi);
  if (btn) btn.disabled = false;
  updateProgress();
  playSelect();
}

function goToStep(step) {
  // Block step 0‚Üí1 if no name entered
  if (currentStep === 0 && step === 1) {
    const nameVal = document.getElementById('userName').value.trim();
    if (!nameVal) {
      const input = document.getElementById('userName');
      input.style.borderColor = '#E17055';
      input.style.boxShadow = '0 0 0 3px rgba(225,112,85,0.15)';
      input.focus();
      input.setAttribute('placeholder', LANG === 'en' ? '‚ö† Please enter your name' : '‚ö† Por favor ingresa tu nombre');
      setTimeout(() => {
        input.style.borderColor = '';
        input.style.boxShadow = '';
        input.setAttribute('placeholder', t().namePlaceholder);
      }, 2500);
      return;
    }
  }
  document.querySelectorAll('.wizard-step').forEach(s => s.classList.remove('active'));
  const target = document.getElementById('step' + step);
  if (target) { target.classList.add('active'); currentStep = step; }
  updateProgress();
  playTick();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function showStep(step) {
  document.querySelectorAll('.wizard-step').forEach(s => s.classList.remove('active'));
  const target = document.getElementById('step' + step);
  if (target) target.classList.add('active');
  currentStep = step;
}

function updateProgress() {
  const count = Object.keys(answers).length;
  const pct = currentStep === 0 ? 0 : (count / 10 * 100);
  document.getElementById('progressFill').style.width = pct + '%';
  const L = t();
  document.getElementById('progressPct').textContent = currentStep === 0 ? '' : `${currentStep} ${L.progOf} 10`;
}

function submitForm() {
  if (Object.keys(answers).length < 10) return;
  playComplete();
  // Save state so results survive page refresh / navigation
  const name = document.getElementById('userName').value.trim();
  sessionStorage.setItem('tv_quiz_state', JSON.stringify({ answers: {...answers}, name, lang: LANG }));
  generateResults();
}

// ===================== RESULTS =====================

function generateResults() {
  const L = t();
  const name = document.getElementById('userName').value.trim() || L.defaultName;
  const sessionId = getOrCreateSessionId();

  const scores = { C:0, S:0, H:0, B:0, T:0 };
  Object.values(answers).forEach(s => scores[s]++);

  const sorted = Object.entries(scores).sort((a,b) => b[1]-a[1]);
  const primary = sorted[0], secondary = sorted[1], weakest = sorted[sorted.length-1];
  const S = L.sections;

  document.getElementById('formContainer').classList.remove('visible');
  document.getElementById('resultsContainer').classList.add('visible');
  document.getElementById('rBadge').textContent = L.rBadge;
  document.getElementById('resultsTitle').textContent = LANG==='en' ? `${name}'s Vocational Profile` : `Perfil Vocacional de ${name}`;
  const dateStr = new Date().toLocaleDateString(L.dateLocale, {year:'numeric',month:'long',day:'numeric'});
  document.getElementById('resultsDate').textContent = dateStr;
  document.getElementById('rFooter').textContent = L.rFooter;
  document.getElementById('rRetake').textContent = L.rRetake;
  document.getElementById('printWatermark').textContent = `testvocacion.netlify.app  ¬∑  ${dateStr}  ¬∑  Career Aptitude Assessment`;

  const pri = L.profiles[primary[0]];
  const sec = L.profiles[secondary[0]];
  const idKey = primary[0]+secondary[0];
  const identity = L.identity[idKey] || L.identity['default'];

  // ----- Build OPEN preview (Sections 01-02) -----
  let openHtml = '';

  // 01
  openHtml += `<div class="result-card">
    <h2><span class="sn">${S.s01t}</span>${S.s01h}</h2>
    <div class="primary-badge" style="background:${colors[primary[0]]}15;color:${colors[primary[0]]}">${L.primary}: ${L.labels[primary[0]]} (${primary[1]}/10)</div>
    <div class="primary-badge" style="background:${colors[secondary[0]]}15;color:${colors[secondary[0]]}">${L.secondary}: ${L.labels[secondary[0]]} (${secondary[1]}/10)</div>
    <p style="margin-top:16px">${L.summaryAnchored(name,L.labels[primary[0]],L.labels[secondary[0]],primary[1]===secondary[1])} ${primary[1]>=5?L.summaryHigh:primary[1]>=3?L.summaryMed:L.summaryLow}</p>
  </div>`;

  // 02 RADAR + BARS
  openHtml += `<div class="result-card">
    <h2><span class="sn">${S.s02t}</span>${S.s02h}</h2>
    <div class="radar-wrap"><canvas id="radarCanvas" width="500" height="500" style="max-width:100%"></canvas></div>
    ${sorted.map(([k,v])=>`<div class="score-row"><span class="score-label" style="color:${colors[k]}">${L.labels[k]}</span><div class="score-bar-bg"><div class="score-bar-fill" data-width="${v*10}" style="background:${colors[k]}"><span class="score-val">${v}/10</span></div></div></div>`).join('')}
  </div>`;

  // ----- Build LOCKED content (Sections 03-10) -----
  let lockedHtml = '';

  // 03
  lockedHtml += `<div class="result-card">
    <h2><span class="sn">${S.s03t}</span>${pri.title}</h2>
    <p>${pri.desc}</p>
    ${secondary[1]>=3?`<p>${L.secDepth(L.labels[secondary[0]],sec.desc.split('.').slice(0,1).join('.'))}</p>`:''}
  </div>`;

  // 04
  lockedHtml += `<div class="result-card"><h2><span class="sn">${S.s04t}</span>${S.s04h}</h2><p>${pri.dna}</p></div>`;

  // 05
  lockedHtml += `<div class="result-card"><h2><span class="sn">${S.s05t}</span>${S.s05h}</h2><div class="trait-grid">${pri.strengths.map(s=>`<div class="trait-item trait-strength">‚úì ${s}</div>`).join('')}</div></div>`;

  // 06
  lockedHtml += `<div class="result-card"><h2><span class="sn">${S.s06t}</span>${S.s06h}</h2><div class="trait-grid">${pri.blindspots.map(s=>`<div class="trait-item trait-blind">‚ö† ${s}</div>`).join('')}</div></div>`;

  // 07 CAREERS
  lockedHtml += `<div class="result-card">
    <h2><span class="sn">${S.s07t}</span>${S.s07h}</h2>
    <div class="career-grid">${pri.careers.map(c=>`<div class="career-item"><strong>${c.name}</strong><span>${c.sub}</span></div>`).join('')}</div>
  </div>`;

  // 08
  lockedHtml += `<div class="result-card"><h2><span class="sn">${S.s08t}</span>${S.s08h}</h2><p>${pri.environment}</p></div>`;

  // 09
  lockedHtml += `<div class="result-card">
    <h2><span class="sn">${S.s09t}</span>${S.s09h}</h2>
    <p>${L.devTip1(L.labels[primary[0]])}</p>
    <p>${L.devTip2(L.labels[weakest[0]],weakest[1])}</p>
    <p>${L.devTip3}</p>
  </div>`;

  // 10
  lockedHtml += `<div class="result-card">
    <h2><span class="sn">${S.s10t}</span>${S.s10h}</h2>
    <p>${L.finalIs(name,L.labels[primary[0]],L.labels[secondary[0]],identity)}</p>
  </div>`;

  // SHARE (always visible)
  const shareHtml = `<div class="share-section">
    <h3>${L.shareTitle}</h3><p>${L.shareSub}</p>
    <div class="share-buttons">
      <button class="share-btn print" onclick="doPrint()"><svg viewBox="0 0 24 24"><path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/></svg>${L.sharePrint}</button>
      <button class="share-btn whatsapp" onclick="shareWhatsApp()"><svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>${L.shareWhatsapp}</button>
    </div></div>`;

  // paywall decision
  const unlocked = isUnlocked(sessionId);

  // summary for share
  const summaryText = pri.desc.split('.').slice(0,2).join('.') + '.';
  window._lastResults = { name, primary:L.labels[primary[0]], secondary:L.labels[secondary[0]], ps:primary[1], ss:secondary[1], summary:summaryText };

  if (unlocked) {
    document.getElementById('resultsBody').innerHTML = openHtml + lockedHtml + shareHtml;
  } else {
    document.getElementById('resultsBody').innerHTML = openHtml + buildLockedPreview(lockedHtml, sessionId, L) + shareHtml;
  }

  // animate bars + radar
  setTimeout(() => {
    document.querySelectorAll('.score-bar-fill').forEach(b => { b.style.width=b.dataset.width+'%'; });
    drawRadar(scores);
    if (!unlocked && typeof paypal !== 'undefined') {
      renderPaywallButtons(sessionId);
    }
  }, 120);

  window.scrollTo({top:0,behavior:'smooth'});
}


// ===================== PAYWALL HELPERS =====================
function getOrCreateSessionId(){
  const key='tv_session_id';
  let v=localStorage.getItem(key);
  if(!v){
    var arr=new Uint8Array(16);
    crypto.getRandomValues(arr);
    var hex=Array.from(arr,function(b){return b.toString(16).padStart(2,'0');}).join('');
    v='sess_'+hex+'_'+Date.now();
    localStorage.setItem(key,v);
  }
  return v;
}

function isUnlocked(sessionId){
  return localStorage.getItem('tv_unlocked_'+sessionId)==='1';
}

function setUnlocked(sessionId){
  localStorage.setItem('tv_unlocked_'+sessionId,'1');
}

function buildLockedPreview(lockedHTML, sessionId, L){
  const isES = (LANG==='es');
  const title = isES ? 'Desbloquea tu Reporte Completo' : 'Unlock Your Full Report';
  const sub = isES
    ? 'Ves un preview: t√≠tulos visibles y detalles borrosos. Paga para ver el an√°lisis completo, exportarlo y guardarlo.'
    : 'You are seeing a preview: titles visible and details blurred. Pay to access the full analysis, export it and save it.';
  return `
    <div class="result-card locked" style="padding:0">
      <div class="locked-content" style="padding:32px">${lockedHTML}</div>
      <div class="locked-overlay">
        <div class="locked-box">
          <h4>${title}</h4>
          <p>${sub}</p>

          <div class="plan-grid">
            <div class="plan-card reco">
              <div class="plan-title">Full Personalized Career Report</div>
              <div class="plan-price">$9.99</div>
              <div class="plan-note">${isES?'Acceso inmediato + PDF':'Instant access + PDF'}</div>
              <div class="paypal-slot" id="pp_full"></div>
            </div>

            <div class="plan-card">
              <div class="plan-title">Share with 3 friends ‚Üí Discount</div>
              <div class="plan-price">$5.99</div>
              <div class="plan-note">${isES?'Disponible al completar 3 referidos':'Available after 3 referrals'}</div>

              <div class="ref-box">
                <label>${isES?'Invita 3 emails (1 por amigo)':'Invite 3 emails (1 per friend)'}</label>
                <div class="ref-row">
                  <input id="ref1" placeholder="email 1">
                  <input id="ref2" placeholder="email 2">
                  <input id="ref3" placeholder="email 3">
                </div>
                <button class="btn-nav btn-next" style="margin-top:10px" onclick="submitRefs('${sessionId}')">
                  ${isES?'Validar Referidos':'Validate Referrals'}
                </button>
                <div class="ref-status" id="ref_status"></div>
              </div>

              <div class="paypal-slot" id="pp_disc" style="display:none"></div>
            </div>
          </div>

          <div class="legal-mini">
            <label style="display:flex;gap:10px;align-items:flex-start;margin-top:10px;">
              <input id="legal_ok" type="checkbox" style="margin-top:3px;">
              <span>
                ${isES
                  ? `Al pagar, aceptas nuestros <a href="/terms.html" target="_blank">T√©rminos</a>, <a href="/privacy.html" target="_blank">Privacidad</a> y <a href="/refund.html" target="_blank">Reembolsos</a>.`
                  : `By paying, you agree to our <a href="/terms.html" target="_blank">Terms</a>, <a href="/privacy.html" target="_blank">Privacy</a> and <a href="/refund.html" target="_blank">Refunds</a>.`
                }
              </span>
            </label>
          </div>
        </div>
      </div>
    </div>
  `;
}

function ensureLegalChecked(){
    const ok = document.getElementById('legal_ok');
    if(!ok || !ok.checked){
          // Scroll to and highlight the checkbox area
          const legalBox = ok ? ok.closest('.legal-mini') : null;
          if(legalBox){
            legalBox.scrollIntoView({behavior:'smooth', block:'center'});
            // Add pulsing highlight
            legalBox.style.transition = 'all 0.3s ease';
            legalBox.style.background = 'rgba(239,68,68,0.12)';
            legalBox.style.borderRadius = '10px';
            legalBox.style.padding = '8px 10px';
            legalBox.style.border = '1.5px solid #ef4444';
            // Show inline reminder message
            var reminder = document.getElementById('legal_reminder');
            if(!reminder){
              reminder = document.createElement('div');
              reminder.id = 'legal_reminder';
              reminder.style.cssText = 'color:#dc2626;font-size:13px;font-weight:600;margin-top:6px;display:flex;align-items:center;gap:6px;';
              legalBox.appendChild(reminder);
            }
            reminder.innerHTML = (LANG==='es')
              ? '&#9660; Acepta los T√©rminos, Privacidad y Reembolsos marcando la casilla'
              : '&#9660; Accept Terms, Privacy & Refunds by checking the box below';
            // Auto-remove highlight after 4s
            setTimeout(function(){
              legalBox.style.background = '';
              legalBox.style.border = '';
              legalBox.style.padding = '';
            }, 4000);
          }
          return false;
    }
    // Remove reminder if it exists when checkbox is checked
    var reminder = document.getElementById('legal_reminder');
    if(reminder) reminder.remove();
    return true;
}

function showPayPalDebug(message){
    let box = document.getElementById('pp_debug');
    if(!box){
          box = document.createElement('div');
          box.id = 'pp_debug';
          box.style.marginTop = '12px';
          box.style.padding = '10px 12px';
          box.style.border = '1.5px solid #f59e0b';
          box.style.background = 'rgba(245,158,11,.10)';
          box.style.borderRadius = '12px';
          box.style.fontSize = '12px';
          box.style.color = '#92400e';
          const host = document.querySelector('.locked-box') || document.body;
          host.appendChild(box);
    }
    box.textContent = message;
}

function renderPaywallButtons(sessionId){
  // FULL
  if (document.getElementById('pp_full')) {
    paypal.Buttons({
      createOrder: async () => {
        if (!ensureLegalChecked()) return;
        const r = await fetch('/.netlify/functions/paypal-create-order', {
                method:'POST',
                headers:{'Content-Type':'application/json'},
                body: JSON.stringify({ tier:'FULL_9_99', sessionId })
        });
        const text = await r.text();
        let d = {};
        try { d = JSON.parse(text); } catch(e) { console.error('Failed to parse create-order response:', e, text); }
        if (!r.ok || !d.id) {
                showPayPalDebug(`Create order failed (${r.status}): ${text}`);
                throw new Error('CREATE_ORDER_FAILED');
        }
        return d.id;
      },
      onApprove: async (data) => {
        const r = await fetch('/.netlify/functions/paypal-capture-order', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ orderId: data.orderID, sessionId, tier:'FULL_9_99' })
        });
        const d = await r.json();
        if (d.status === 'COMPLETED') {
          setUnlocked(sessionId);
          location.reload();
        } else {
          alert((LANG==='es') ? 'Pago no completado.' : 'Payment not completed.');
        }
      },
      onCancel: () => alert((LANG==='es') ? 'Pago cancelado.' : 'Payment cancelled.'),
      onError: (e) => { console.error(e); showPayPalDebug(String(e)); alert(LANG==='es'?'Error con PayPal. Revisa el detalle.':'PayPal error. See details.'); }
    }).render('#pp_full');
  }
}

function isValidEmail(email){
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

async function submitRefs(sessionId){
  const e1=(document.getElementById('ref1').value||'').trim();
  const e2=(document.getElementById('ref2').value||'').trim();
  const e3=(document.getElementById('ref3').value||'').trim();
  const box=document.getElementById('ref_status');

  var emails=[e1,e2,e3].filter(Boolean);
  if(emails.length<3){
    box.style.color='#BF6C00';
    box.textContent=(LANG==='es')?'Ingresa 3 emails v√°lidos.':'Please enter 3 valid emails.';
    return;
  }
  for(var i=0;i<emails.length;i++){
    if(!isValidEmail(emails[i])){
      box.style.color='#BF6C00';
      box.textContent=(LANG==='es')?'Email inv√°lido: '+emails[i]:'Invalid email: '+emails[i];
      return;
    }
  }

  box.textContent = (LANG==='es') ? 'Validando y enviando invitaciones...' : 'Validating and sending invitations...';

  const referrerName = (document.getElementById('userName').value||'').trim();

  const r = await fetch('/.netlify/functions/referral-invite', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ sessionId, emails:[e1,e2,e3], referrerName })
  });
  const d = await r.json();
  if (!d.ok) {
    box.style.color = '#BF6C00';
    box.textContent = d.message || 'Error';
    return;
  }

  const r2 = await fetch('/.netlify/functions/referral-count', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ sessionId })
  });
  const d2 = await r2.json();
  const count = d2.count || 0;

  if (count >= 3) {
    box.style.color = '#00876A';
    box.textContent = (LANG==='es') ? '‚úÖ Listo: descuento habilitado.' : '‚úÖ Ready: discount enabled.';
    document.getElementById('pp_disc').style.display='block';

    paypal.Buttons({
      createOrder: async () => {
if (!ensureLegalChecked()) return;
          const rr = await fetch('/.netlify/functions/paypal-create-order', {
                  method:'POST',
                  headers:{'Content-Type':'application/json'},
                  body: JSON.stringify({ tier:'DISC_5_99', sessionId })
          });
            const text = await rr.text();
            let d = {};
            try { d = JSON.parse(text); } catch(e) { console.error('Failed to parse create-order response:', e, text); }
            if (!rr.ok || !d.id) {
                    showPayPalDebug(`Create order failed (${rr.status}): ${text}`);
                    throw new Error('CREATE_ORDER_FAILED');
            }
            return d.id;
          },
      onError: (e) => { console.error(e); showPayPalDebug(String(e)); alert(LANG==='es'?'Error con PayPal. Revisa el detalle.':'PayPal error. See details.'); },
      onApprove: async (data) => {
        const rr = await fetch('/.netlify/functions/paypal-capture-order', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ orderId: data.orderID, sessionId, tier:'DISC_5_99' })
        });
        const dd = await rr.json();
        if (dd.status === 'COMPLETED') {
          setUnlocked(sessionId);
          location.reload();
        } else {
          alert((LANG==='es') ? 'Pago no completado.' : 'Payment not completed.');
        }
      },
      onCancel: () => alert((LANG==='es') ? 'Pago cancelado.' : 'Payment cancelled.'),
      onError: (e) => { console.error(e); alert((LANG==='es') ? 'Error con PayPal.' : 'PayPal error.'); }
    }).render('#pp_disc');

  } else {
    box.style.color = '#BF6C00';
    box.textContent = (LANG==='es')
      ? `A√∫n faltan ${3-count} referidos para habilitar el descuento.`
      : `${3-count} more referrals needed to unlock the discount.`;
  }
}



// ===================== RADAR (Pentagon for 5 dimensions) =====================
function drawRadar(scores) {
  const canvas = document.getElementById('radarCanvas');
  if (!canvas) return;
  const dpr = window.devicePixelRatio||1;
  const cssW=500, cssH=500;
  canvas.width=cssW*dpr; canvas.height=cssH*dpr;
  canvas.style.width=cssW+'px'; canvas.style.height=cssH+'px';
  const ctx=canvas.getContext('2d');
  ctx.scale(dpr,dpr);

  const cx=cssW/2, cy=cssH/2, maxR=160;
  const cats=['C','S','H','B','T'];
  const names=t().radarNames;
  const cols=[colorHex.C,colorHex.S,colorHex.H,colorHex.B,colorHex.T];
  // 5 points: top, top-right, bottom-right, bottom-left, top-left
  const angles = cats.map((_,i) => -Math.PI/2 + (2*Math.PI*i/5));

  // Grid rings
  for(let lv=10;lv>=2;lv-=2){
    const r=maxR*lv/10;
    ctx.beginPath();
    angles.forEach((a,i)=>{const x=cx+r*Math.cos(a),y=cy+r*Math.sin(a);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
    ctx.closePath(); ctx.fillStyle=lv%4===0?'#F0F0FA':'#F7F7FC'; ctx.fill(); ctx.strokeStyle='#D8DFE8'; ctx.lineWidth=0.8; ctx.stroke();
  }

  // Axes
  angles.forEach(a=>{ctx.beginPath();ctx.moveTo(cx,cy);ctx.lineTo(cx+maxR*Math.cos(a),cy+maxR*Math.sin(a));ctx.strokeStyle='#D0D5DE';ctx.lineWidth=0.8;ctx.stroke();});

  // Scale numbers
  for(let lv=2;lv<=10;lv+=2){const r=maxR*lv/10;ctx.font='500 10px DM Sans';ctx.fillStyle='#A0A8B8';ctx.textAlign='left';ctx.textBaseline='middle';ctx.fillText(lv,cx+6,cy-r+1);}

  // Data polygon
  ctx.beginPath();
  cats.forEach((c,i)=>{const r=maxR*Math.max(scores[c],0.3)/10,x=cx+r*Math.cos(angles[i]),y=cy+r*Math.sin(angles[i]);i===0?ctx.moveTo(x,y):ctx.lineTo(x,y);});
  ctx.closePath();
  const grad=ctx.createRadialGradient(cx,cy,0,cx,cy,maxR);
  grad.addColorStop(0,'rgba(108,92,231,0.3)'); grad.addColorStop(1,'rgba(108,92,231,0.05)');
  ctx.fillStyle=grad; ctx.fill(); ctx.strokeStyle='#6C5CE7'; ctx.lineWidth=2.5; ctx.stroke();

  // Points + labels
  cats.forEach((c,i)=>{
    const r=maxR*Math.max(scores[c],0.3)/10,x=cx+r*Math.cos(angles[i]),y=cy+r*Math.sin(angles[i]);
    ctx.beginPath();ctx.arc(x,y,10,0,Math.PI*2);ctx.fillStyle=cols[i]+'20';ctx.fill();
    ctx.beginPath();ctx.arc(x,y,6,0,Math.PI*2);ctx.fillStyle=cols[i];ctx.fill();ctx.strokeStyle='white';ctx.lineWidth=2.5;ctx.stroke();

    const sr=maxR*Math.max(scores[c],0.3)/10+20,sx=cx+sr*Math.cos(angles[i]),sy=cy+sr*Math.sin(angles[i]);
    ctx.font='700 15px DM Sans';ctx.fillStyle=cols[i];ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(scores[c],sx,sy);

    const lr=maxR+50,lx=cx+lr*Math.cos(angles[i]),ly=cy+lr*Math.sin(angles[i]);
    ctx.font='700 12px DM Sans';ctx.fillStyle=cols[i];ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(names[i],lx,ly);
  });
}

// ===================== SHARE =====================
function shareWhatsApp() {
  const L = t();
  const r = window._lastResults;
  const summary = r.summary.substring(0, 150);
  let msg = '';
  if (LANG === 'es') {
    msg = `üéì *Test de Aptitud Vocacional*\n\nüë§ *${r.name}*\nüèÜ Primario: *${r.primary}* (${r.ps}/10)\nü•à Secundario: *${r.secondary}* (${r.ss}/10)\n\n${summary}\n\n‚úÖ ¬°Haz el test t√∫ tambi√©n!\nüîó https://testvocacion.netlify.app/`;
  } else {
    msg = `üéì *Career Aptitude Test*\n\nüë§ *${r.name}*\nüèÜ Primary: *${r.primary}* (${r.ps}/10)\nü•à Secondary: *${r.secondary}* (${r.ss}/10)\n\n${summary}\n\n‚úÖ Take the test yourself!\nüîó https://testvocacion.netlify.app/`;
  }
  window.open('https://wa.me/?text=' + encodeURIComponent(msg), '_blank');
}

function doPrint() {
  window.print();
}

// ===================== RETAKE =====================
function retake() {
  document.getElementById('resultsContainer').classList.remove('visible');
  document.getElementById('langScreen').classList.remove('hidden');
  Object.keys(answers).forEach(k=>delete answers[k]);
  document.getElementById('userName').value='';
  sessionStorage.removeItem('tv_quiz_state');
}
</script>

<script>
// PayPal SDK ‚Äî load dynamically using the Client ID from the server env vars.
// This ensures frontend and backend always use the same credentials.
(async function(){
  try {
    var resp = await fetch('/.netlify/functions/paypal-config');
    var cfg  = await resp.json();
    if (!cfg.clientId) { console.error('PayPal config: missing clientId', cfg); return; }
    var s = document.createElement('script');
    s.src = 'https://www.paypal.com/sdk/js?client-id=' + encodeURIComponent(cfg.clientId) + '&currency=USD&enable-funding=card&disable-funding=paylater';
    s.async = true;
    document.body.appendChild(s);
  } catch(e) { console.error('Failed to load PayPal config:', e); }
})();
</script>
</body>
  <style>
    @media (max-width: 600px){
        .main { padding-bottom: 140px; } /* espacio extra */
        .nav-buttons{
              position: sticky;
        bottom: calc(14px + env(safe-area-inset-bottom));
              background: rgba(245,243,255,0.92);
              backdrop-filter: blur(10px);
              padding: 10px;
              border-radius: 14px;
              box-shadow: var(--shadow-lg);
              z-index: 50;
    }
    }
    </style>
  <script>
    // Scroll nav buttons into view when changing questions (Next/Prev)
    // Wrap original nextQuestion and prevQuestion functions
    const originalNextQuestion = typeof nextQuestion === 'function' ? nextQuestion : null;
    const originalPrevQuestion = typeof prevQuestion === 'function' ? prevQuestion : null;

    if (originalNextQuestion) {
        window.nextQuestion = function() {
              originalNextQuestion.apply(this, arguments);
              setTimeout(() => {
                      document.querySelector('.nav-buttons')?.scrollIntoView({block:'end', behavior:'smooth'});
              }, 50);
        };
    }

    if (originalPrevQuestion) {
        window.prevQuestion = function() {
              originalPrevQuestion.apply(this, arguments);
              setTimeout(() => {
                      document.querySelector('.nav-buttons')?.scrollIntoView({block:'end', behavior:'smooth'});
              }, 50);
        };
    }

    // Fallback: Also monitor for click events on buttons with next/prev in their id or classes
    document.addEventListener('DOMContentLoaded', function() {
        const nextButtons = document.querySelectorAll('[onclick*="next"], .next-btn, [id*="next"]');
        const prevButtons = document.querySelectorAll('[onclick*="prev"], .prev-btn, [id*="prev"]');

        nextButtons.forEach(btn => {
              btn.addEventListener('click', function() {
                      setTimeout(() => {
                                document.querySelector('.nav-buttons')?.scrollIntoView({block:'end', behavior:'smooth'});
                      }, 50);
              });
        });

        prevButtons.forEach(btn => {
              btn.addEventListener('click', function() {
                      setTimeout(() => {
                                document.querySelector('.nav-buttons')?.scrollIntoView({block:'end', behavior:'smooth'});
                      }, 50);
              });
        });

                    // Add event listeners for START buttons
                      const startFreBtn = document.getElementById('btn-start-free');
                    const startPaidBtn = document.getElementById('btn-start-paid');

                      if (startFreBtn) {
                                            startFreBtn.addEventListener('click', function() {
                                                                      showIntroCard();
                                            });
                      }

                      if (startPaidBtn) {
                                            startPaidBtn.addEventListener('click', function() {
                                                                      showIntroCard();
                                            });
                      }
    });

    // ======================== RESTORE RESULTS ON PAGE LOAD ========================
    window.addEventListener('load', () => {
        try {
            const raw = sessionStorage.getItem('tv_quiz_state');
            if (!raw) return;
            const st = JSON.parse(raw);
            if (!st || !st.answers || Object.keys(st.answers).length < 10) return;

            // Restore language, answers, and name ‚Äî then regenerate results
            LANG = st.lang || 'en';
            Object.assign(answers, st.answers);
            buildForm();
            document.getElementById('userName').value = st.name || '';

            // Hide lang screen, show results directly
            document.getElementById('langScreen').classList.add('hidden');
            generateResults();
        } catch(e) { /* ignore corrupt state */ }
    });
  </script>
</html>
